<div class="photo-detail-modal">
  <h2 mat-dialog-title>
    {{ 'PHOTO_DETAIL.TITLE' | translate }}
    <button mat-icon-button class="close-button" (click)="onClose()">
      <mat-icon>close</mat-icon>
    </button>
  </h2>

  <mat-dialog-content>
    <div class="photo-container">
      <img [src]="data.photo.url" [alt]="data.photo.filename" class="main-photo">
    </div>

    @if (isLoadingDetails) {
      <div class="loading-details">
        <mat-spinner diameter="30"></mat-spinner>
        <span>{{ 'PHOTO_DETAIL.LOADING' | translate }}</span>
      </div>
    } @else {
      <div class="photo-info">
        <div class="info-row">
          <mat-icon>image</mat-icon>
          <span class="label">{{ 'PHOTO_DETAIL.FILENAME' | translate }}:</span>
          <span class="value">{{ photoDetails?.filename || data.photo.filename }}</span>
        </div>

        @if (photoDetails?.dateTaken) {
          <div class="info-row">
            <mat-icon>schedule</mat-icon>
            <span class="label">{{ 'PHOTO_DETAIL.DATE_TAKEN' | translate }}:</span>
            <span class="value">{{ formatDate(photoDetails!.dateTaken!) }}</span>
          </div>
        }

        @if (photoDetails?.cameraModel || photoDetails?.cameraMake) {
          <div class="info-row">
            <mat-icon>camera_alt</mat-icon>
            <span class="label">{{ 'PHOTO_DETAIL.CAMERA' | translate }}:</span>
            <span class="value">{{ photoDetails?.cameraMake }} {{ photoDetails?.cameraModel }}</span>
          </div>
        }

        @if (photoDetails?.latitude && photoDetails?.longitude) {
          <div class="info-row">
            <mat-icon>location_on</mat-icon>
            <span class="label">{{ 'PHOTO_DETAIL.LOCATION' | translate }}:</span>
            <span class="value">{{ photoDetails!.latitude!.toFixed(4) }}, {{ photoDetails!.longitude!.toFixed(4) }}</span>
          </div>
        }

        <!-- Weather Section -->
        @if (photoDetails?.photoWeather) {
          <div class="weather-section">
            <h3>
              <mat-icon>wb_cloudy</mat-icon>
              {{ 'PHOTO_DETAIL.WEATHER_AT_TIME' | translate }}
            </h3>
            <div class="weather-card">
              <!-- master - MARSISCA - BEGIN 2026-01-24 -->
              <div class="weather-main">
                @if (photoDetails!.photoWeather!.weatherIconUrl) {
                  <img [src]="photoDetails!.photoWeather!.weatherIconUrl" alt="Weather icon" class="weather-icon-img">
                } @else {
                  <mat-icon class="weather-icon">{{ getWeatherIcon(photoDetails!.photoWeather!.wmoCode) }}</mat-icon>
                }
                <div class="weather-temp">{{ formatTemperature(photoDetails!.photoWeather!.temperature) }}</div>
                <div class="weather-description">{{ getWeatherDescription(photoDetails!.photoWeather!.wmoCode) }}</div>
              </div>
              <!-- master - MARSISCA - END 2026-01-24 -->
              <div class="weather-details">
                <div class="weather-detail-item">
                  <mat-icon>air</mat-icon>
                  <span class="detail-label">{{ 'PHOTO_DETAIL.WIND' | translate }}</span>
                  <span class="detail-value">{{ formatWindSpeed(photoDetails!.photoWeather!.windSpeed) }}</span>
                </div>
                <div class="weather-detail-item">
                  <mat-icon>water_drop</mat-icon>
                  <span class="detail-label">{{ 'PHOTO_DETAIL.PRECIPITATION' | translate }}</span>
                  <span class="detail-value">{{ formatPrecipitation(photoDetails!.photoWeather!.precipitationMm) }}</span>
                </div>
                <div class="weather-detail-item">
                  <mat-icon>cloud</mat-icon>
                  <span class="detail-label">{{ 'PHOTO_DETAIL.CLOUD_COVERAGE' | translate }}</span>
                  <span class="detail-value">{{ formatCloudCoverage(photoDetails!.photoWeather!.cloudCoverage) }}</span>
                </div>
              </div>
            </div>
          </div>
        }
      </div>
    }

    @if (data.canEdit) {
      <form [formGroup]="photoForm" class="photo-form">
        <mat-checkbox formControlName="isMain">
          {{ 'PHOTO_DETAIL.IS_MAIN' | translate }}
        </mat-checkbox>
      </form>
    } @else {
      @if (data.photo.isMain) {
        <div class="main-photo-badge">
          <mat-icon>star</mat-icon>
          <span>{{ 'PHOTO_DETAIL.MAIN_PHOTO' | translate }}</span>
        </div>
      }
    }

    @if (errorMessage) {
      <div class="error-message">
        {{ errorMessage }}
      </div>
    }
  </mat-dialog-content>

  <mat-dialog-actions align="end">
    @if (data.canEdit) {
      <button mat-button color="warn" (click)="onDelete()" [disabled]="isLoading">
        <mat-icon>delete</mat-icon>
        {{ 'PHOTO_DETAIL.DELETE' | translate }}
      </button>
    }
    <button mat-button (click)="onClose()" [disabled]="isLoading">
      {{ 'PHOTO_DETAIL.CANCEL' | translate }}
    </button>
    @if (data.canEdit) {
      <button mat-raised-button color="primary" (click)="onSave()" [disabled]="isLoading || photoForm.invalid">
        {{ 'PHOTO_DETAIL.SAVE' | translate }}
      </button>
    }
  </mat-dialog-actions>
</div>
