<!-- master - MARSISCA - BEGIN 2025-11-01 -->
<div class="trip-form-modal">
  <h2 mat-dialog-title>{{ mode === 'create' ? 'Add New Trip' : 'Edit Trip' }}</h2>

  <mat-dialog-content>
    <mat-tab-group>
      <!-- General Tab -->
      <mat-tab label="General">
        <div class="tab-content">
          <form [formGroup]="tripForm">
            <mat-form-field appearance="outline" class="full-width">
              <mat-label>Trip Name</mat-label>
              <input
                matInput
                type="text"
                formControlName="name"
                placeholder="My trip to Europe"
              />
              @if (tripForm.get('name')?.invalid && tripForm.get('name')?.touched) {
                <mat-error>{{ getNameError() }}</mat-error>
              }
            </mat-form-field>

            <mat-form-field appearance="outline" class="full-width">
              <mat-label>Description</mat-label>
              <textarea
                matInput
                formControlName="description"
                placeholder="An incredible journey through historic cities..."
                rows="3"
              ></textarea>
            </mat-form-field>

            <div class="date-fields">
              <mat-form-field appearance="outline" class="date-field">
                <mat-label>Start Date</mat-label>
                <input
                  matInput
                  [matDatepicker]="startPicker"
                  formControlName="startDate"
                  placeholder="DD/MM/YYYY"
                />
                <mat-datepicker-toggle matIconSuffix [for]="startPicker"></mat-datepicker-toggle>
                <mat-datepicker #startPicker></mat-datepicker>
                @if (tripForm.get('startDate')?.invalid && tripForm.get('startDate')?.touched) {
                  <mat-error>{{ getStartDateError() }}</mat-error>
                }
              </mat-form-field>

              <mat-form-field appearance="outline" class="date-field">
                <mat-label>End Date</mat-label>
                <input
                  matInput
                  [matDatepicker]="endPicker"
                  formControlName="endDate"
                  placeholder="DD/MM/YYYY"
                />
                <mat-datepicker-toggle matIconSuffix [for]="endPicker"></mat-datepicker-toggle>
                <mat-datepicker #endPicker></mat-datepicker>
                @if (tripForm.get('endDate')?.invalid && tripForm.get('endDate')?.touched) {
                  <mat-error>{{ getEndDateError() }}</mat-error>
                }
              </mat-form-field>
            </div>

            <div class="rating-field">
              <label class="rating-label">Rating</label>
              <app-star-rating
                formControlName="rating"
                [maxStars]="5"
              ></app-star-rating>
              @if (tripForm.get('rating')?.invalid && tripForm.get('rating')?.touched) {
                <div class="rating-error">{{ getRatingError() }}</div>
              }
            </div>
          </form>
        </div>
      </mat-tab>

      <!-- Photos Tab -->
      <mat-tab label="Photos">
        <div class="tab-content">
          <!-- Existing Photos -->
          @if (existingPhotos.length > 0) {
            <div class="existing-photos-section">
              <h3>Existing Photos</h3>
              <div class="photos-grid">
                @for (photo of existingPhotos; track photo.id) {
                  <div class="photo-preview" (click)="viewPhoto(photo.url)">
                    <img [src]="photo.url" [alt]="photo.filename" />
                    <button
                      mat-icon-button
                      class="remove-photo"
                      type="button"
                      (click)="deleteExistingPhoto(photo.id, $event)"
                    >
                      <mat-icon>delete</mat-icon>
                    </button>
                    <div class="photo-name">{{ photo.filename }}</div>
                  </div>
                }
              </div>
            </div>
          }

          <!-- Upload Zone -->
          <div class="upload-section">
            @if (existingPhotos.length > 0) {
              <h3>Add More Photos</h3>
            }
            <div
              class="upload-zone"
              (drop)="onFileDrop($event)"
              (dragover)="onDragOver($event)"
            >
              <mat-icon>cloud_upload</mat-icon>
              <p>Drag and drop photos here or click to select</p>
              <input
                type="file"
                #fileInput
                multiple
                accept="image/*"
                (change)="onFilesSelected($event)"
                style="display: none"
              />
              <button
                mat-raised-button
                color="primary"
                type="button"
                (click)="fileInput.click()"
              >
                Select Photos
              </button>
            </div>

            @if (photoPreviews.length > 0) {
              <div class="photos-grid new-photos">
                @for (preview of photoPreviews; track $index) {
                  <div class="photo-preview">
                    <img [src]="preview.url" [alt]="preview.file.name" />
                    <button
                      mat-icon-button
                      class="remove-photo"
                      type="button"
                      (click)="removePhoto($index)"
                    >
                      <mat-icon>close</mat-icon>
                    </button>
                    <div class="photo-name">{{ preview.file.name }}</div>
                  </div>
                }
              </div>
            }
          </div>
        </div>
      </mat-tab>
    </mat-tab-group>

    @if (errorMessage) {
      <div class="error-message">
        {{ errorMessage }}
      </div>
    }
  </mat-dialog-content>

  <mat-dialog-actions align="end">
    <button
      mat-button
      type="button"
      (click)="onCancel()"
      [disabled]="isLoading"
    >
      Cancel
    </button>
    <button
      mat-raised-button
      color="primary"
      (click)="onSubmit()"
      [disabled]="isLoading || tripForm.invalid"
    >
      @if (isLoading) {
        <mat-spinner diameter="20"></mat-spinner>
      } @else {
        {{ mode === 'create' ? 'Create Trip' : 'Update Trip' }}
      }
    </button>
  </mat-dialog-actions>
</div>
<!-- master - MARSISCA - END 2025-11-01 -->
