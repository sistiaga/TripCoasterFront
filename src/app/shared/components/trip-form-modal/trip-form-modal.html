<!-- master - MARSISCA - BEGIN 2026-01-03 -->
<div class="trip-form-modal">
  <h2 mat-dialog-title>{{ mode === 'create' ? 'Add New Trip' : 'Edit Trip' }}</h2>

  <mat-dialog-content>
    <div class="form-content">
      <form [formGroup]="tripForm">
            <mat-form-field appearance="outline" class="full-width">
              <mat-label>Trip Name</mat-label>
              <input
                matInput
                type="text"
                formControlName="name"
                placeholder="My trip to Europe"
              />
              @if (tripForm.get('name')?.invalid && tripForm.get('name')?.touched) {
                <mat-error>{{ getNameError() }}</mat-error>
              }
            </mat-form-field>

            <mat-form-field appearance="outline" class="full-width">
              <mat-label>Description</mat-label>
              <textarea
                matInput
                formControlName="description"
                placeholder="An incredible journey through historic cities..."
                rows="3"
              ></textarea>
            </mat-form-field>

            <div class="date-fields">
              <mat-form-field appearance="outline" class="date-field">
                <mat-label>Start Date</mat-label>
                <input
                  matInput
                  [matDatepicker]="startPicker"
                  formControlName="startDate"
                  placeholder="DD/MM/YYYY"
                />
                <mat-datepicker-toggle matIconSuffix [for]="startPicker"></mat-datepicker-toggle>
                <mat-datepicker #startPicker></mat-datepicker>
                @if (tripForm.get('startDate')?.invalid && tripForm.get('startDate')?.touched) {
                  <mat-error>{{ getStartDateError() }}</mat-error>
                }
              </mat-form-field>

              <mat-form-field appearance="outline" class="date-field">
                <mat-label>End Date</mat-label>
                <input
                  matInput
                  [matDatepicker]="endPicker"
                  formControlName="endDate"
                  placeholder="DD/MM/YYYY"
                />
                <mat-datepicker-toggle matIconSuffix [for]="endPicker"></mat-datepicker-toggle>
                <mat-datepicker #endPicker></mat-datepicker>
                @if (tripForm.get('endDate')?.invalid && tripForm.get('endDate')?.touched) {
                  <mat-error>{{ getEndDateError() }}</mat-error>
                }
              </mat-form-field>
            </div>


            <!-- master - MARSISCA - BEGIN 2026-01-03 -->
            <!-- Weather -->
            <mat-form-field appearance="outline" class="full-width">
              <mat-label>{{ 'TRIP_FORM.WEATHER' | translate }}</mat-label>
              <mat-select formControlName="weatherTypeId">
                <mat-option [value]="null">{{ 'TRIP_FORM.NO_WEATHER' | translate }}</mat-option>
                @for (weather of weathers; track weather.id) {
                  <mat-option [value]="weather.id">
                    <div class="option-with-icon">
                      @if (getIconUrl(weather.icon)) {
                        <img [src]="getIconUrl(weather.icon)" class="option-icon" [alt]="weather.nameEnglish">
                      }
                      <span>{{ getCurrentLangName(weather) }}</span>
                    </div>
                  </mat-option>
                }
              </mat-select>
            </mat-form-field>

            <!-- Accommodation -->
            <mat-form-field appearance="outline" class="full-width">
              <mat-label>{{ 'TRIP_FORM.ACCOMMODATION' | translate }}</mat-label>
              <mat-select formControlName="accommodationTypeId">
                <mat-option [value]="null">{{ 'TRIP_FORM.NO_ACCOMMODATION' | translate }}</mat-option>
                @for (accommodation of accommodations; track accommodation.id) {
                  <mat-option [value]="accommodation.id">
                    <div class="option-with-icon">
                      @if (getIconUrl(accommodation.icon)) {
                        <img [src]="getIconUrl(accommodation.icon)" class="option-icon" [alt]="accommodation.nameEnglish">
                      }
                      <span>{{ getCurrentLangName(accommodation) }}</span>
                    </div>
                  </mat-option>
                }
              </mat-select>
            </mat-form-field>

            <!-- Transportation -->
            <mat-form-field appearance="outline" class="full-width">
              <mat-label>{{ 'TRIP_FORM.TRANSPORTATION' | translate }}</mat-label>
              <mat-select formControlName="transportationTypeId">
                <mat-option [value]="null">{{ 'TRIP_FORM.NO_TRANSPORTATION' | translate }}</mat-option>
                @for (transport of transportationTypes; track transport.id) {
                  <mat-option [value]="transport.id">
                    <div class="option-with-icon">
                      @if (getIconUrl(transport.icon)) {
                        <img [src]="getIconUrl(transport.icon)" class="option-icon" [alt]="transport.nameEnglish">
                      }
                      <span>{{ getCurrentLangName(transport) }}</span>
                    </div>
                  </mat-option>
                }
              </mat-select>
            </mat-form-field>

            <!-- Country -->
            <mat-form-field appearance="outline" class="full-width">
              <mat-label>{{ 'TRIP_FORM.COUNTRY' | translate }}</mat-label>
              <input
                type="text"
                matInput
                [formControl]="countryControl"
                [matAutocomplete]="autoCountry"
                [placeholder]="'TRIP_FORM.SEARCH_COUNTRY' | translate"
              />
              <mat-autocomplete #autoCountry="matAutocomplete" [displayWith]="displayCountryFn.bind(this)" (optionSelected)="onCountrySelected($event)">
                @for (country of filteredCountries | async; track country.id) {
                  <mat-option [value]="country">
                    <div class="option-with-icon">
                      @if (getFlagUrl(country.flagPath)) {
                        <img [src]="getFlagUrl(country.flagPath)" class="country-flag" [alt]="country.nameEnglish">
                      }
                      <span>{{ getCurrentLangName(country) }}</span>
                    </div>
                  </mat-option>
                }
              </mat-autocomplete>
              @if (countryControl.value && !isCountryObject(countryControl.value)) {
                <button mat-icon-button matSuffix (click)="clearCountry()" type="button">
                  <mat-icon>close</mat-icon>
                </button>
              }
            </mat-form-field>
            <!-- master - MARSISCA - END 2026-01-03 -->

            <div class="rating-field">
              <label class="rating-label">Rating</label>
              <app-star-rating
                formControlName="rating"
                [maxStars]="5"
              ></app-star-rating>
              @if (tripForm.get('rating')?.invalid && tripForm.get('rating')?.touched) {
                <div class="rating-error">{{ getRatingError() }}</div>
              }
            </div>

          </form>
    </div>

    @if (errorMessage) {
      <div class="error-message">
        {{ errorMessage }}
      </div>
    }
  </mat-dialog-content>

  <mat-dialog-actions align="end">
    <button
      mat-button
      type="button"
      (click)="onCancel()"
      [disabled]="isLoading"
    >
      Cancel
    </button>
    <button
      mat-raised-button
      color="primary"
      (click)="onSubmit()"
      [disabled]="isLoading || tripForm.invalid"
    >
      @if (isLoading) {
        <mat-spinner diameter="20"></mat-spinner>
      } @else {
        {{ mode === 'create' ? 'Create Trip' : 'Update Trip' }}
      }
    </button>
  </mat-dialog-actions>
</div>
<!-- master - MARSISCA - END 2026-01-03 -->
