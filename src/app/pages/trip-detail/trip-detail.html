<!-- master - MARSISCA - BEGIN 2025-11-30 -->
<div class="trip-detail-page" *ngIf="!isLoading && trip">
  <!-- master - MARSISCA - BEGIN 2026-01-16 -->
  <!-- Hero Section - Redesigned with photo on left, info on right -->
  <div class="hero-section-redesigned">
    <button mat-icon-button class="back-button" (click)="goBack()">
      <mat-icon>arrow_back</mat-icon>
    </button>

    <div class="hero-container">
      <!-- Left: Main Photo -->
      <div class="hero-photo-container">
        @if (getHeroImage()) {
          <img [src]="getHeroImage()" [alt]="trip.name" class="hero-photo">
        } @else {
          <div class="hero-photo-placeholder">
            <mat-icon>image</mat-icon>
          </div>
        }
      </div>

      <!-- Right: Trip Information -->
      <div class="hero-info-container">
        <h1 class="trip-title">{{ trip.name }}</h1>

        <div class="trip-meta">
          <div class="meta-item">
            <mat-icon>event</mat-icon>
            <span>{{ formatDate(trip.startDate) }} - {{ formatDate(trip.endDate) }}</span>
          </div>

          @if (trip.rating) {
            <div class="meta-item">
              <app-star-rating
                [readOnly]="true"
                [maxStars]="5"
                [value]="trip.rating"
              ></app-star-rating>
            </div>
          }
        </div>

        @if (trip.description) {
          <div class="trip-description-preview">
            <p>{{ trip.description }}</p>
          </div>
        }

        <!-- Trip Attributes -->
        @if (trip.weatherType || trip.accommodationType || trip.transportationType) {
          <div class="trip-attributes">
            @if (trip.weatherType) {
              <div class="attribute-item">
                @if (getIconUrl(trip.weatherType.icon)) {
                  <img [src]="getIconUrl(trip.weatherType.icon)" class="attribute-icon" [alt]="trip.weatherType.nameEnglish">
                }
                <span>{{ getCurrentLangName(trip.weatherType) }}</span>
              </div>
            }
            @if (trip.accommodationType) {
              <div class="attribute-item">
                @if (getIconUrl(trip.accommodationType.icon)) {
                  <img [src]="getIconUrl(trip.accommodationType.icon)" class="attribute-icon" [alt]="trip.accommodationType.nameEnglish">
                }
                <span>{{ getCurrentLangName(trip.accommodationType) }}</span>
              </div>
            }
            @if (trip.transportationType) {
              <div class="attribute-item">
                @if (getIconUrl(trip.transportationType.icon)) {
                  <img [src]="getIconUrl(trip.transportationType.icon)" class="attribute-icon" [alt]="trip.transportationType.nameEnglish">
                }
                <span>{{ getCurrentLangName(trip.transportationType) }}</span>
              </div>
            }
          </div>
        }

        <!-- Countries Visited -->
        @if (trip.countries && trip.countries.length > 0) {
          <div class="countries-section">
            <h3>{{ 'TRIP_DETAIL.COUNTRIES_VISITED' | translate }}</h3>
            <div class="countries-flags">
              @for (country of trip.countries; track country.id) {
                <div class="country-flag-item" [title]="getCurrentLangName(country)">
                  <img [src]="getIconUrl(country.flagPath)" [alt]="getCurrentLangName(country)" class="country-flag">
                </div>
              }
            </div>
          </div>
        }

        <button mat-fab color="primary" class="edit-fab" (click)="editTrip()">
          <mat-icon>edit</mat-icon>
        </button>
      </div>
    </div>
  </div>
  <!-- master - MARSISCA - END 2026-01-16 -->

  <!-- Content Sections -->
  <div class="content-container">

    <!-- master - MARSISCA - BEGIN 2026-01-16 -->
    <!-- Trip Info Section - Removed as description is now in hero section -->
    <!-- master - MARSISCA - END 2026-01-16 -->

    <!-- Destinations Section -->
    <section class="section-card">
      <div class="section-card-header">
        <mat-icon>place</mat-icon>
        <h2>{{ 'TRIP_DETAIL.DESTINATIONS' | translate }}</h2>
      </div>
      <div class="section-card-content">
        <div class="map-container" *ngIf="trip.locations && trip.locations.length > 0">
          <app-trip-map [locations]="trip.locations"></app-trip-map>
        </div>

        <div class="destinations-grid" *ngIf="trip.locations && trip.locations.length > 0">
          <div class="item-card" *ngFor="let location of trip.locations">
            <div class="item-card-icon">
              <mat-icon>location_on</mat-icon>
            </div>
            <div class="destination-info">
              <h3>{{ location.name }}@if (location.country) { ({{ location.country.nameEnglish }})} </h3>
              <span class="coordinates">
                {{ location.latitude.toFixed(4) }}, {{ location.longitude.toFixed(4) }}
              </span>
            </div>
          </div>
        </div>
        <div class="empty-state" *ngIf="!trip.locations || trip.locations.length === 0">
          <mat-icon>add_location</mat-icon>
          <p>{{ 'TRIP_DETAIL.NO_DESTINATIONS' | translate }}</p>
          <button mat-raised-button color="primary" (click)="editTrip()">
            {{ 'TRIP_DETAIL.ADD_DESTINATIONS' | translate }}
          </button>
        </div>
      </div>
    </section>

    <!-- Diary Section -->
    <section class="section-card diary-section">
      <div class="section-card-header">
        <mat-icon>book</mat-icon>
        <h2>{{ 'TRIP_DETAIL.DIARY' | translate }}</h2>
      </div>
      <div class="section-card-content">
        <app-trip-diary [tripId]="trip.id" [tripStartDate]="trip.startDate" [tripEndDate]="trip.endDate"></app-trip-diary>
      </div>
    </section>

    <!-- Photos Section -->
    <section class="section-card photos-section">
      <div class="section-card-header">
        <mat-icon>photo_library</mat-icon>
        <h2>{{ 'TRIP_DETAIL.PHOTOS' | translate }}</h2>
        @if (trip.photos && trip.photos.length > 0) {
          <button mat-raised-button color="primary" (click)="uploadNewPhotos()">
            <mat-icon>add_photo_alternate</mat-icon>
            {{ 'TRIP_DETAIL.ADD_PHOTOS' | translate }}
          </button>
        }
      </div>
      <div class="section-card-content">
        <div class="photos-grid" *ngIf="trip.photos && trip.photos.length > 0">
          <div class="photo-item" *ngFor="let photo of getVisiblePhotos()">
            <div class="photo-wrapper">
              <img [src]="photo.url" [alt]="photo.filename" (click)="openPhotoDetail(photo)">
              <div class="photo-actions">
                <button mat-icon-button
                        class="photo-action-btn"
                        (click)="toggleMainPhoto(photo); $event.stopPropagation()"
                        [class.is-main]="photo.isMain"
                        [matTooltip]="photo.isMain ? ('TRIP_DETAIL.MAIN_PHOTO' | translate) : ('TRIP_DETAIL.SET_AS_MAIN' | translate)">
                  <mat-icon>{{ photo.isMain ? 'star' : 'star_border' }}</mat-icon>
                </button>
                <button mat-icon-button
                        class="photo-action-btn delete-btn"
                        (click)="deletePhoto(photo); $event.stopPropagation()"
                        [matTooltip]="'TRIP_DETAIL.DELETE_PHOTO' | translate">
                  <mat-icon>delete</mat-icon>
                </button>
              </div>
            </div>
          </div>
          <div class="more-photos" *ngIf="hasMorePhotos()" (click)="editTrip()">
            <div class="more-photos-overlay">
              <span>+{{ getMorePhotosCount() }}</span>
              <p>{{ 'TRIP_DETAIL.MORE_PHOTOS' | translate }}</p>
            </div>
          </div>
        </div>
        <div class="empty-state" *ngIf="!trip.photos || trip.photos.length === 0">
          <mat-icon>add_photo_alternate</mat-icon>
          <p>{{ 'TRIP_DETAIL.NO_PHOTOS' | translate }}</p>
          <button mat-raised-button color="primary" (click)="uploadNewPhotos()">
            {{ 'TRIP_DETAIL.ADD_PHOTOS' | translate }}
          </button>
        </div>
      </div>
    </section>

  </div>
</div>

<!-- Loading State -->
<div class="loading-state" *ngIf="isLoading">
  <mat-icon class="loading-icon">flight_takeoff</mat-icon>
  <p>{{ 'TRIP_DETAIL.LOADING' | translate }}</p>
</div>

<!-- Not Found State -->
<div class="not-found-container" *ngIf="!isLoading && !trip">
  <mat-icon>error_outline</mat-icon>
  <h2>{{ 'TRIP_DETAIL.NOT_FOUND' | translate }}</h2>
  <button mat-raised-button color="primary" (click)="goBack()">
    {{ 'TRIP_DETAIL.GO_BACK' | translate }}
  </button>
</div>
<!-- master - MARSISCA - END 2025-11-30 -->
